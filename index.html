<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YT PLUS ADMIN</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Padauk:wght@400;700&display=swap');
        
        :root {
            --primary-dark: #1e6b65;
            --primary: #2a9d8f;
            --bg-main: #f8fafc;
            --white: #ffffff;
            --active: #10b981;
            --inactive: #f59e0b;
            --offline: #ef4444;
        }

        body {
            font-family: 'Outfit', 'Padauk', sans-serif;
            background: #238b81;
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- Header Section --- */
        .admin-header {
            width: 100%; max-width: 450px;
            padding: 20px; box-sizing: border-box; color: white;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .app-info { display: flex; align-items: center; gap: 10px; }
        .logo-box { width: 45px; height: 45px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 20px; }

        /* --- Stats Row --- */
        .stats-container {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;
        }
        .stat-card {
            background: rgba(255,255,255,0.2); backdrop-filter: blur(5px);
            padding: 10px 5px; border-radius: 10px; text-align: center;
            cursor: pointer; transition: 0.3s; border: 1px solid transparent;
        }
        .stat-card:active { transform: scale(0.95); background: rgba(255,255,255,0.3); }
        .stat-card.active-filter { border: 1px solid white; background: rgba(255,255,255,0.4); }

        .stat-num { font-size: 20px; font-weight: 800; display: block; }
        .stat-label { font-size: 10px; font-weight: bold; opacity: 0.9; }

        /* --- Content Body --- */
        .main-content {
            width: 100%; max-width: 450px; background: var(--bg-main);
            border-top-left-radius: 30px; border-top-right-radius: 30px;
            min-height: 80vh; padding: 20px; box-sizing: border-box;
        }

        /* --- Search & Add --- */
        .search-box {
            background: white; border-radius: 10px; display: flex; align-items: center;
            padding: 10px 15px; border: 1px solid #e2e8f0; margin-bottom: 15px;
        }
        .search-box input { border: none; outline: none; width: 100%; padding-left: 10px; }
        .btn-add-main {
            width: 100%; padding: 12px; background: var(--primary); color: white;
            border: none; border-radius: 10px; font-weight: bold; font-size: 16px;
            margin-bottom: 20px; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px;
        }

        /* --- User Card --- */
        .user-card {
            background: white; border-radius: 15px; padding: 15px;
            margin-bottom: 15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            border: 1px solid #f1f5f9; position: relative;
        }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .user-profile { display: flex; align-items: center; gap: 10px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .status-badge { font-size: 9px; padding: 3px 8px; border-radius: 20px; font-weight: bold; }
        
        .info-grid { display: grid; grid-template-columns: 30px 100px 1fr; font-size: 13px; gap: 5px; margin-top: 5px; }
        .info-grid i { color: var(--primary); }
        .info-label { color: #64748b; }
        .info-value { font-weight: 600; color: #1e293b; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .progress-container { margin-top: 15px; }
        .progress-bar { height: 6px; background: #e2e8f0; border-radius: 10px; overflow: hidden; margin-bottom: 5px; }
        .progress-fill { height: 100%; background: var(--active); transition: 0.3s; }

        .card-actions { display: flex; gap: 8px; margin-top: 15px; border-top: 1px solid #f1f5f9; padding-top: 10px; }
        .action-btn { flex: 1; padding: 8px; border: none; border-radius: 5px; font-size: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 4px; }

        /* --- Modal --- */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: white; width: 95%; max-width: 380px; border-radius: 20px; padding: 20px; box-sizing: border-box; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; }

    </style>
</head>
<body>

    <div class="admin-header">
        <div class="header-top">
            <div class="app-info">
                <div class="logo-box"><i class="fab fa-youtube"></i></div>
                <div>
                    <div style="font-weight: bold; font-size: 18px;">YT PLUS ADMIN</div>
                    <div style="font-size: 11px; opacity: 0.8;">Manage VIP Users</div>
                </div>
            </div>
            <i class="fas fa-sign-out-alt"></i>
        </div>

        <div class="stats-container">
            <div class="stat-card" onclick="filterByStatus('all')">
                <span class="stat-num" id="stat-all">0</span>
                <span class="stat-label">ALL</span>
            </div>
            <div class="stat-card" style="color: #4ade80;" onclick="filterByStatus('active')">
                <span class="stat-num" id="stat-active">0</span>
                <span class="stat-label">ACTIVE</span>
            </div>
            <div class="stat-card" style="color: #facc15;" onclick="filterByStatus('inactive')">
                <span class="stat-num" id="stat-inactive">0</span>
                <span class="stat-label">INACTIVE</span>
            </div>
            <div class="stat-card" style="color: #f87171;" onclick="filterByStatus('offline')">
                <span class="stat-num" id="stat-offline">0</span>
                <span class="stat-label">OFFLINE</span>
            </div>
        </div>
        <div style="text-align: center; font-size: 12px; opacity: 0.7;">Power By : Jue Htet</div>
    </div>

    <div class="main-content">
        <div class="search-box">
            <i class="fas fa-search" style="color: #94a3b8;"></i>
            <input type="text" id="searchInput" placeholder="Search users..." onkeyup="filterUsers()">
        </div>

        <button class="btn-add-main" onclick="openModal()">
            <i class="fas fa-plus-circle"></i> Add New User
        </button>

        <div id="userList">
            </div>
    </div>

    <div class="modal" id="userModal">
        <div class="modal-content">
            <h3 style="margin-top: 0; color: var(--primary-dark);"><i class="fas fa-user-plus"></i> User Data</h3>
            <div class="form-group">
                <label>Token ID</label>
                <input type="text" id="f-id" placeholder="Paste Token ID">
            </div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="f-name" placeholder="User Name">
            </div>
            <div class="form-group">
                <label>Expired Date</label>
                <input type="date" id="f-exp">
            </div>
            <div class="form-group">
                <label>Price (à¸¿)</label>
                <input type="number" id="f-price" placeholder="50">
            </div>
            <div class="form-group">
                <label>Status</label>
                <select id="f-status" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e2e8f0;">
                    <option value="true">Active</option>
                    <option value="false">Offline</option>
                </select>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="saveUser()" style="flex:1; padding:12px; background:var(--primary); color:white; border:none; border-radius:8px; font-weight:bold;">SAVE DATA</button>
                <button onclick="closeModal()" style="flex:1; padding:12px; background:#e2e8f0; border:none; border-radius:8px;">CANCEL</button>
            </div>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDGCsxM1ccZ_ZswwNPZDI-ykOm5yJU1CIw",
        authDomain: "yt-plus-f2adb.firebaseapp.com",
        projectId: "yt-plus-f2adb",
        storageBucket: "yt-plus-f2adb.appspot.com",
        messagingSenderId: "395214377046",
        appId: "1:395214377046:android:86e632965381ea0d7d6bf7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const usersCol = collection(db, "users");
    let allUsersData = [];

    onSnapshot(usersCol, (snap) => {
        allUsersData = [];
        let active = 0, offline = 0, inactive = 0;
        const today = new Date();

        snap.forEach(d => {
            const data = { id: d.id, ...d.data() };
            allUsersData.push(data);
            
            const expDate = new Date(data.expiryDate);
            const isExpired = expDate < today;

            if(isExpired) {
                inactive++;
            } else if(data.isActive) {
                active++;
            } else {
                offline++;
            }
        });
        document.getElementById('stat-all').innerText = allUsersData.length;
        document.getElementById('stat-active').innerText = active;
        document.getElementById('stat-inactive').innerText = inactive;
        document.getElementById('stat-offline').innerText = offline;
        renderUsers(allUsersData);
    });

    // Filter by Status Function
    window.filterByStatus = (status) => {
        const today = new Date();
        let filtered = [];

        // UI highlight for selection
        document.querySelectorAll('.stat-card').forEach(card => card.classList.remove('active-filter'));
        
        if(status === 'all') {
            filtered = allUsersData;
        } else if(status === 'active') {
            filtered = allUsersData.filter(u => u.isActive && new Date(u.expiryDate) >= today);
        } else if(status === 'inactive') {
            filtered = allUsersData.filter(u => new Date(u.expiryDate) < today);
        } else if(status === 'offline') {
            filtered = allUsersData.filter(u => !u.isActive && new Date(u.expiryDate) >= today);
        }

        renderUsers(filtered);
    };

    window.renderUsers = (data) => {
        const list = document.getElementById('userList');
        list.innerHTML = "";
        data.forEach(user => {
            const exp = new Date(user.expiryDate);
            const remain = Math.ceil((exp - new Date()) / (1000 * 60 * 60 * 24));
            const days = remain > 0 ? remain : 0;
            const percent = Math.min(100, Math.max(3, (days / 30) * 100));
            
            const isExpired = remain <= 0;

            const card = document.createElement('div');
            card.className = 'user-card';
            card.innerHTML = `
                <div class="card-header">
                    <div class="user-profile">
                        <div class="avatar">${(user.username || "U").charAt(0).toUpperCase()}</div>
                        <div style="font-weight: bold; color: #1e293b;">${user.username} ðŸ‘‘</div>
                    </div>
                    <span class="status-badge" style="background:${isExpired ? '#fef3c7' : (user.isActive ? '#dcfce7':'#fee2e2')}; color:${isExpired ? '#92400e' : (user.isActive ? '#166534':'#991b1b')}">
                        ${isExpired ? 'INACTIVE' : (user.isActive ? 'ACTIVE' : 'OFFLINE')}
                    </span>
                </div>
                <div class="info-grid"><i class="fas fa-key"></i> <span class="info-label">Token ID:</span> <span class="info-value">${user.id}</span></div>
                <div class="info-grid"><i class="fas fa-calendar-alt"></i> <span class="info-label">Expired Date:</span> <span class="info-value">${user.expiryDate}</span></div>
                <div class="info-grid"><i class="fas fa-coins"></i> <span class="info-label">Price:</span> <span class="info-value" style="color:var(--primary)">${user.price} à¸¿</span></div>
                <div class="info-grid"><i class="fas fa-clock"></i> <span class="info-label">Remaining Days:</span> <span class="info-value" style="color:${days < 3 ? 'red':'#10b981'}">${days} days</span></div>
                
                <div class="progress-container">
                    <div class="progress-bar"><div class="progress-fill" style="width: ${percent}%; background: ${days < 3 ? '#f43f5e':'#2a9d8f'}"></div></div>
                    <div style="text-align:right; font-size:10px; color:#94a3b8;"><i class="fas fa-chart-line"></i> ${Math.floor(percent)}%</div>
                </div>

                <div class="card-actions">
                    <button class="action-btn" style="background:#f1f5f9;" onclick="editUser('${user.id}')"><i class="fas fa-edit"></i> Edit</button>
                    <button class="action-btn" style="background:#fee2e2; color:#ef4444;" onclick="deleteUser('${user.id}')"><i class="fas fa-trash"></i> Delete</button>
                    <button class="action-btn" style="background:#dcfce7; color:#166534;" onclick="saveImage(this)"><i class="fas fa-save"></i> Save</button>
                </div>
            `;
            list.appendChild(card);
        });
    };

    window.openModal = () => {
        document.getElementById('f-id').value = "";
        document.getElementById('f-name').value = "";
        document.getElementById('f-exp').value = "";
        document.getElementById('f-price').value = "";
        document.getElementById('userModal').style.display = 'flex';
    };

    window.closeModal = () => document.getElementById('userModal').style.display = 'none';

    window.saveUser = async () => {
        const id = document.getElementById('f-id').value;
        if(!id) return alert("ID á€›á€­á€¯á€€á€ºá€•á€«");
        await setDoc(doc(db, "users", id), {
            username: document.getElementById('f-name').value,
            expiryDate: document.getElementById('f-exp').value,
            price: document.getElementById('f-price').value,
            isActive: document.getElementById('f-status').value === "true"
        }, { merge: true });
        closeModal();
    };

    window.editUser = (id) => {
        const u = allUsersData.find(x => x.id === id);
        document.getElementById('f-id').value = u.id;
        document.getElementById('f-name').value = u.username;
        document.getElementById('f-exp').value = u.expiryDate;
        document.getElementById('f-price').value = u.price;
        document.getElementById('f-status').value = u.isActive.toString();
        document.getElementById('userModal').style.display = 'flex';
    };

    window.deleteUser = async (id) => {
        if(confirm("á€–á€»á€€á€ºá€™á€¾á€¬á€œá€¬á€¸?")) await deleteDoc(doc(db, "users", id));
    };

    window.filterUsers = () => {
        const q = document.getElementById('searchInput').value.toLowerCase();
        renderUsers(allUsersData.filter(u => u.username.toLowerCase().includes(q) || u.id.toLowerCase().includes(q)));
    };

    window.saveImage = (btn) => {
        const card = btn.closest('.user-card');
        const actions = card.querySelector('.card-actions');
        actions.style.display = 'none';
        html2canvas(card, { scale: 3 }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'User_Card.png';
            link.href = canvas.toDataURL();
            link.click();
            actions.style.display = 'flex';
        });
    };
</script>
</body>
</html>
